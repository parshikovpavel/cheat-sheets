https://github.com/golang/mock

https://pkg.go.dev/github.com/golang/mock/gomock

https://golang.org/pkg/testing/

https://www.philosophicalhacker.com/post/integration-tests-in-go/

https://github.com/stretchr/testify#assert-package

https://pkg.go.dev/github.com/stretchr/testify/assert#Assertions





# `package testing`

*Package* `testing` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è *Go package*'s –û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–º–µ—Å—Ç–µ —Å `go test` *command*, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ª—é–±–æ–π *function* –≤–∏–¥–∞:

```go
func TestXxx(*testing.T)
```

–≥–¥–µ Xxx –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ —Å—Ç—Ä–æ—á–Ω–æ–π –±—É–∫–≤—ã. 

–í —ç—Ç–∏—Ö *function*'s –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Error()`, `Fail()` –∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ *,*'—ã, —á—Ç–æ–±—ã —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–± –æ—à–∏–±–∫–µ.

–ò–º—è —Ñ–∞–π–ª–∞ —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –≤–∏–¥:

```
<name>_test.go
```

–ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ç–æ—Ç –∂–µ *package* (–∏–ª–∏ —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `_test`), —á—Ç–æ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–¥. –§–∞–π–ª –±—É–¥–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ –æ–±—ã—á–Ω—ã—Ö *package build*'–æ–≤, –Ω–æ –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `go test` *command*'—ã. 

## Benchmark

–¢–∞–∫–∂–µ [–∑–¥–µ—Å—å –ø—Ä–æ pprof](pprof.md#benchmark)

*Function*'s –≤–∏–¥–∞

```go
func BenchmarkXxx(*testing.B)
```

—Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ *benchmark*'–∏ –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è `go test` *command*'–æ–π, –∫–æ–≥–¥–∞ —É–∫–∞–∑–∞–Ω –µ–µ —Ñ–ª–∞–≥ `-bench`. *Benchmark*'–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.

–ü—Ä–∏–º–µ—Ä *benchmark function* –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```go
func BenchmarkRandInt(b *testing.B) {
    for i := 0; i < b.N; i++ {
        rand.Int()
    }
}
```

*Benchmark function* –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ü–µ–ª–µ–≤–æ–π –∫–æ–¥ `b.N` —Ä–∞–∑. –í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è *benchmark*'–∞, b.N –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ *benchmark function* –Ω–µ –ø—Ä–æ–¥–ª–∏—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–ª–≥–æ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞–¥–µ–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è. –í—ã–≤–æ–¥:

```
BenchmarkRandInt-8   	68453040	        17.8 ns/op
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ü–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–ª—Å—è 68453040 —Ä–∞–∑ —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é 17,8 ns –Ω–∞ —Ü–∏–∫–ª.

TODO!!!







### –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

[link](https://stackoverflow.com/questions/19998250/proper-package-naming-for-testing-with-the-go-language)

–°—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤. –û–Ω–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥ –≤ —Ç–æ–º –∂–µ *package*, —á—Ç–æ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–¥, –∏–ª–∏ –Ω–µ—Ç

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–ª–æ–≥–æ —è—â–∏–∫–∞**

–ò–º—è —Ñ–∞–π–ª–∞: github.com/user/myfunc.go

```golang
package myfunc
```

–ò–º—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞: github.com/user/myfunc_test.go

```golang
package myfunc
```

–ü—Ä–∏ —ç—Ç–æ–º –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ non-exported identifier's –∏ –∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–µ. 

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≥–æ —è—â–∏–∫–∞**

–ò–º—è —Ñ–∞–π–ª–∞: github.com/user/myfunc.go

```golang
package myfunc
```

–ò–º—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞: github.com/user/myfunc_test.go

```golang
package myfunc_test

import (
    "github.com/user/myfunc"
)
```

–í —Ç–µ—Å—Ç–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ *exported identifier*'s.

–≠—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –î–û–õ–ñ–ù–ê —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞–º

1. –ò–º–µ–Ω–∞ package's:
   - –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ package ‚Äì `NameOfDirectory`.
   - –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ package ‚Äì `NameOfDirectory` + `_test`.
2. –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –≤ `_test` *package* –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞`_test.go`

–≠—Ç–æ –±–æ–ª–µ–µ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, —Ç.–∫. —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–∞–∫–µ—Ç–∞, —Ç.–µ. –µ–≥–æ *exported identifiers* –∏ –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏. 

–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å `package XXX_test` –±—É–¥—É—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π *package*, –∞ –∑–∞—Ç–µ–º —Å–≤—è–∑–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∫–æ–¥–æ–º.

–§–∞–π–ª `XXX_test.go` –±—É–¥–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ –æ–±—ã—á–Ω—ã—Ö —Å–±–æ—Ä–æ–∫ –ø–∞–∫–µ—Ç–∞, –Ω–æ –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω –≤ —Å–±–æ—Ä–∫—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–º–∞–Ω–¥—ã `go test`. 



<u>–ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏</u>

–í —Ñ–∞–π–ª–µ —Å —Ç–µ—Å—Ç–∞–º–∏ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∏–¥–∞ (–≥–¥–µ `<FuncName>` ‚Äì –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã):

```go
func Test<FuncName>(t *testing.T) {
 	// ... 
}
```

<u>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Ç–µ—Å—Ç–æ–º</u>

–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞:

```go
package stringutil

import "testing"

func TestReverse(t *testing.T) {
	cases := []struct {
		in, want string
	}{
		{"Hello, world", "dlrow ,olleH"},
		{"Hello, ‰∏ñÁïå", "Áïå‰∏ñ ,olleH"},
		{"", ""},
	}
	for _, c := range cases {
		got := Reverse(c.in)
		if got != c.want {
			t.Errorf("Reverse(%q) == %q, want %q", c.in, got, c.want) // –Ω–µ—É–¥–∞—á–Ω—ã–π —Ç–µ—Å—Ç
		}
	}
}
```

–í —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Ç–µ—Å—Ç–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã `t.Error`, `t.Errorf`, `t.Fail`,..., —á—Ç–æ–±—ã –æ–ø–æ–≤–µ—Å—Ç–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ç–µ—Å—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ—É–¥–∞—á–Ω—ã–º.

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

https://golang.org/cmd/go/#hdr-Test_packages

–û–±—â–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã:

```
go test [build/test flags] [packages] [build/test flags & test binary flags]
```

–ö–æ–º–∞–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ *package*'s, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é *import path*'s. 

–í –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:

```
$ go test
PASS
ok      example.com/greetings   0.364s
```

–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `-v`:

```bash
$ go test -v
=== RUN   TestHelloName
--- PASS: TestHelloName (0.00s)
=== RUN   TestHelloEmpty
--- PASS: TestHelloEmpty (0.00s)
PASS
ok      example.com/greetings   0.372s
```

–ü—Ä–∏ —ç—Ç–æ–º –±—É–¥—É—Ç –∑–∞–ø—É—â–µ–Ω—ã:

  - –∏–∑ package `<import_path>` 
  - –∏–∑ —Ñ–∞–π–ª–æ–≤ –≤–∏–¥–∞ `<name>_test.go`
  - –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π –≤–∏–¥–∞ `Test<FuncName>` 



–ö–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–∞ –≤ –¥–≤—É—Ö *mode*'s:

- *local directory mode*. –ö–æ–º–∞–Ω–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ `[packages]` –≤ –≤–∏–¥–µ:

  ```bash
  go test
  ```

  –ö–æ–º–∞–Ω–¥–∞ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–¥—ã *package*'s –∏ *test*'s, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—É—â–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ, –∞ –∑–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫. 

  –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ.

  –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ `go test` –ø–µ—á–∞—Ç–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞:

  >  C—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∞ ('ok' –∏–ª–∏ 'FAIL'), *package name* –∏ –∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.

- *package list mode* (—Ä–µ–∂–∏–º —Å–ø–∏—Å–∫–∞ –ø–∞–∫–µ—Ç–æ–≤). –í–∫–ª—é—á–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —É–∫–∞–∑–∞–Ω –∞—Ä–≥—É–º–µ–Ω—Ç `[packages]`:

  ```bash
  go test [packages]
  go test github.com/user/stringutil
  go test math
  go test ./...  # –í–ª–æ–∂–µ–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ (—Å–º. —ÅommandGo.go#relative-import-path)
  go test .      # –¢–µ–∫—É—â–∏–π –∫–∞—Ç–∞–ª–æ–≥
  ```

  –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö *package*'s. –ï—Å–ª–∏ —Ç–µ—Å—Ç *package* –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ, `go test` –ø–µ—á–∞—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ `ok`. –ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ—É—Å–ø–µ—à–µ–Ω, `go test` –ø–µ—á–∞—Ç–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç (??? —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ *package*, —Ç.–µ. –∫–∞–∂–¥—ã–π package —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ). –° —Ñ–ª–∞–≥–∞–º–∏ `-bench` –∏ `-v`, `go test` –≤—Å–µ–≥–¥–∞ –ø–µ—á–∞—Ç–∞–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –æ—Ç—á–µ—Ç—ã –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ *package* –±—É–¥—É—Ç –Ω–∞–ø–µ—á–∞—Ç–∞–Ω—ã, `go test` –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç –æ–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç `FAIL` –µ—Å–ª–∏ –∫–∞–∫–æ–π-–ª–∏–±–æ —Ç–µ—Å—Ç –∫–∞–∫–æ–≥–æ-–ª–∏–±–æ *package* –±—ã–ª –Ω–µ—É—Å–ø–µ—à–µ–Ω.
  
  –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ —É—Å–ø–µ—à–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è *package*'s –∫–µ—à–∏—Ä—É—é—Ç—Å—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–Ω—É–∂–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤. –ö–æ–≥–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –∫–µ—à–∞, `go test` –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏—Ç –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç. –ü—Ä–∏ —ç—Ç–æ–º `go test` –ø–µ—á–∞—Ç–∞–µ—Ç `(cached)` –≤–º–µ—Å—Ç–æ –∏—Å—Ç–µ–∫—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ.



–í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ *build flag*'–∞–º, –Ω–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã *flag*'–∏, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ —Å–∞–º–∏–º `go test`:

- `-c`

  –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç *test binary* –≤ `<pkg>.test`, –Ω–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ (–≥–¥–µ `<pkg>` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç *package's import path*). –ò–º—è —Ñ–∞–π–ª–∞ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å –ø–æ–º–æ—â—å—é —Ñ–ª–∞–≥–∞ `-o`.



#### *Testing flag*'–∏

–°–ª–µ–¥—É—é—â–∏–µ *flag*'–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è `go test` *command*'–æ–π –∏ —É–ø—Ä–∞–≤–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ª—é–±–æ–≥–æ —Ç–µ—Å—Ç–∞:

- `-bench regexp`

  –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ *benchmark*'–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç *regular expression*. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–∏–∫–∞–∫–∏–µ *benchmark*'–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è. –ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ *benchmark*'–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `-bench .` –∏–ª–∏ `-bench=.`. 

  TODO!!!

- 

- 

  

–°–ª–µ–¥—É—é—â–∏–µ *flag*'–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è *test*'–æ–≤ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

- `-benchmem`
  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –≤—Ä–µ–º–µ–Ω–∏/–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é (ns/op) ‚Äì –≤—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ *memory allocation* –¥–ª—è *benchmark* (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ *memory allocation*)

- `-cpuprofile cpu.out`
  –ó–∞–ø–∏—Å–∞—Ç—å *CPU profile* –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç *test binary*, –∫–∞–∫ –∏ `-c` *flag*.
- `-memprofile mem.out`
  –ü–∏—à–µ—Ç *allocation profile* –≤ —Ñ–∞–π–ª –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—Å–µ *test*'—ã –ø—Ä–æ–π–¥–µ–Ω—ã. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç *test binary*, –∫–∞–∫ –∏ `-c` *flag*.





#### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å —Ñ–ª–∞–≥–æ–º `-race`

TODO!!!!

–°–ø—Ä–∞—à–∏–≤–∞—é—Ç, –≤–∞–∂–Ω–æ





## `type T` –∏ `type B`

### `Run()`

```go
func (t *T) Run(name string, f func(t *T)) bool
func (b *B) Run(name string, f func(b *B)) bool
```

`Run()` –∑–∞–ø—É—Å–∫–∞–µ—Ç `f()` –∫–∞–∫ *subtest* –¥–ª—è `t` —Å –∏–º–µ–Ω–µ–º `name`. –û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç `f()` –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π *goroutine* –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (—Ç.–µ. –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ—Å—Ç—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ `f()` –Ω–µ –≤–µ—Ä–Ω–µ—Ç—Å—è –∏–ª–∏ –Ω–µ –≤—ã–∑–æ–≤–µ—Ç `t.Parallel()`, —á—Ç–æ–±—ã —Å—Ç–∞—Ç—å *parallel test*. –¢–µ—Å—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `t.Parallel()`.

`Run()` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å *subtest*'s –∏ *sub-benchmark*'s –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å *table-driven benchmarks* –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å *hierarchical tests*. –û–Ω —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –æ–±—â–∏–º –∫–æ–¥–æ–º *setup* –∏ *tear-down*:

```go
func TestFoo(t *testing.T) {
    // <setup code>
    t.Run("A=1", func(t *testing.T) { ... })
    t.Run("A=2", func(t *testing.T) { ... })
    t.Run("B=1", func(t *testing.T) { ... })
    // <tear-down code>
}
```



–°–º. [Table driven test](#table-driven-test)



–ö–∞–∂–¥—ã–π *subtest* –∏ *sub-benchmark* –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ *name*: –æ–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∫–∞–∫ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è *name* —Ç–µ—Å—Ç–∞ —Å–∞–º–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ *name*'s, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –≤ `Run()`, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö *slash*'s (`/`), —Å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∑–∞–≤–µ—Ä—à–∞—é—â–∏–º –ø–æ—Ä—è–¥–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ —Å –æ–¥–Ω–∏–º –∏–º–µ–Ω–µ–º).





## `type T`

–¢–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏—é `Test<FuncName>(t *testing.T)` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ç–µ—Å—Ç–∞.

–¢–µ—Å—Ç –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏—è `Test<FuncName>(t *testing.T)`  –≤—ã–∑—ã–≤–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤:

- `FailNow`
- `Fatal`
- `Fatalf`
- `SkipNow`
- `Skip`
- `Skipf`

–≠—Ç–∏ –º–µ—Ç–æ–¥—ã, –∞ —Ç–∞–∫–∂–µ –º–µ—Ç–æ–¥ `Parallel`, –¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ *goroutine*, –≤—ã–ø–æ–ª–Ω—è—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏—é `Test<FuncName>()`.

–î—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Log`, `Error`), –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö *goroutine*'s.

```
type T struct {
     // contains filtered or unexported fields
}
```

### `Errorf()`

```
func (c *T) Errorf(format string, args ...interface{})
```

–§—É–Ω–∫—Ü–∏—è, —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–∞ `Logf()`, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º —Å–ª–µ–¥—É–µ—Ç `Fail()`.

### `Fail()`

```
func (c *T) Fail()
```

`Fail()` –æ—Ç–º–µ—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

### `FailNow()`

```go
func (c *T) FailNow()
```

`FailNow()` –æ—Ç–º–µ—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –≤—ã–∑—ã–≤–∞—è `runtime.Goexit` (–∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ `defer` –≤—ã–∑–æ–≤—ã –≤ —Ç–µ–∫—É—â–µ–π *goroutine*). –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–æ —Å–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ *test* –∏–ª–∏ *benchmark*. `FailNow()` –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∏–∑ *goroutine*, –≤—ã–ø–æ–ª–Ω—è—é—â–µ–π *test* –∏–ª–∏ *benchmark function*, –∞ –Ω–µ –∏–∑ –¥—Ä—É–≥–∏—Ö *goroutine*'s, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞. –í—ã–∑–æ–≤ `FailNow()` –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç—Ç–∏ –¥—Ä—É–≥–∏–µ *goroutine*'s.

### `Fatalf()`

```go
func (c *T) Fatalf(format string, args ...interface{})
```

–§—É–Ω–∫—Ü–∏—è, —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–∞ `Logf()`, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º —Å–ª–µ–¥—É–µ—Ç `FailNow()`.

### `Logf()`

```
func (c *T) Logf(format string, args ...interface{})
```

–§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç `args` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å `format`, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `Printf()`, –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –≤ *error log*. –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ü–µ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ *newline*, —Ç–æ –æ–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è. 

- –î–ª—è *test*, —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –Ω–∞–ø–µ—á–∞—Ç–∞–Ω —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Ç–µ—Å—Ç —Ç–µ—Ä–ø–∏—Ç –Ω–µ—É–¥–∞—á—É (*fail*) –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–ª–∞–≥ `-test.v`. 
- –î–ª—è *benchmark*, —Ç–µ–∫—Å—Ç –≤—Å–µ–≥–¥–∞ –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è





# Design

## Table-driven test

–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è *table-driven test*'s —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ü–∏–∫–ª–∞ `for`, –≤ —Ç–µ–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ `t.Run()`.

```go
func TestParse_Success(t *testing.T) {
	cases := []struct {
    name          string 
		displayType   string
		expected      int
	}{
		{"test grid", "grid", 1},
    {"test list", "list", 2},
	}

	for _, test := range cases {
		t.Run(test.name, func(t *testing.T) {
      res := func()
			require.Equal(t, test.expected, res)
		})
	}
}
```



# –ú–æ–∫–∏

## –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ mock'–æ–≤

–í—Å—Ç—Ä–µ—á–∞–ª 3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

- —Ñ–∞–π–ª—ã —Å –º–æ–∫–∞–º–∏ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ  `mocks` –∏ –≤ `package mocks`. –ü—Ä–∏–º–µ—Ä—ã [1](https://blog.codecentric.de/en/2017/08/gomock-tutorial/) –∏ [2](https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1). 

  –ù–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–Ω–µ–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö —Å—Ç–∞—Ç—å—è—Ö. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å mock'–∏ –∏–∑ –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö *package*'s.

- —Ñ–∞–π–ª —Å –º–æ–∫–∞–º–∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ *package*, —á—Ç–æ –∏ –∏—Å—Ö–æ–¥–Ω—ã–π *interface*. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏ —Ç–µ—Å—Ç—ã —Ç–∞–∫–∂–µ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ —Ç–æ–º –∂–µ *package* ([—Å—Ç—Ä–∞—Ç–µ–≥–∏—è 1](#–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ-—Ç–µ—Å—Ç–æ–≤)). –ü—Ä–∏–º–µ—Ä: service-search.

  –ù–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, –≤—Å–µ –≤ –æ–¥–Ω–æ–º *package*. —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –±–µ–ª–æ–≥–æ —è—â–∏–∫–∞.

- —Ñ–∞–π–ª —Å –º–æ–∫–∞–º–∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Ç–µ—Å—Ç–∞–º–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º `package XXX_test`  ([—Å—Ç—Ä–∞—Ç–µ–≥–∏—è 2](#–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ-—Ç–µ—Å—Ç–æ–≤)). –í –∫–æ–Ω—Ü–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤ —Å *mock*'–∞–º–∏ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å `_test` ‚Äì `mocks_test.go` (—Ç.–∫. –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–æ–ª–∂–Ω–æ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞–º –∏–∑ [—Å—Ç—Ä–∞—Ç–µ–≥–∏—è 2](#–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ-—Ç–µ—Å—Ç–æ–≤)) –ü—Ä–∏–º–µ—Ä: service-search-filters, bx-api

  –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ—Ö `go generate` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∏–º–µ–Ω–∏ *package* –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `${GOPACKAGE}_test`:
  
  ```go
  //go:generate mockgen -source $GOFILE -destination mocks_test.go -package ${GOPACKAGE}_test
  ```
  
  
  
  –°—Ç—Ä–∞—Ç–µ–≥–∏—è —á–µ—Ä–Ω–æ–≥–æ —è—â–∏–∫–∞.



## –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –¥–ª—è mock'–æ–≤

[—Å–º–æ—Ç—Ä–∏](Design.md#C—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ-–º–æ–¥—É–ª—è-—Å-–≤–Ω–µ—à–Ω–µ–π-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é)





## `gomock`

`gomock` ‚Äì —ç—Ç–æ:

- *package*
- —Ä–µ–∞–ª–∏–∑—É–µ—Ç *mock framework* –¥–ª—è Go.

 `mockgen` ‚Äì –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞. –ï–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å *mock*'s –∏ –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫. 

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –∏–º–µ–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –≤ —Å–æ—Å—Ç–∞–≤–µ `github.com/golang`
- –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º `testing` *package*,

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

- –ø–æ–¥–∫–ª—é—á–∏—Ç—å `gomock`:

  ```bash
  go get github.com/golang/mock/gomock
  ```
  
  
    –ü—Ä–∏ —ç—Ç–æ–º –≤ `go.mod` –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ:

  ```
  require github.com/golang/mock v1.5.0
  ```

- —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `mockgen`:

  ```bash
  go get github.com/golang/mock/mockgen
  ```

  –ü—Ä–∏ —ç—Ç–æ–º `mockgen` –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–∞–ø–∫—É `$GOPATH/bin/mockgen`. –ò –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω:

  ```bash
  $ mockgen
  ```

## `mockgen`

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ mock'–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `mockgen`.



### –†–µ–∂–∏–º—ã `mockgen`

`mockgen` –∏–º–µ–µ—Ç –¥–≤–∞ *mode*'s: 

- *source mode*
- *reflect mode*.

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ *source mode* –∏ *reflect mode* ‚Äì –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π. 

#### Source mode

–í *source mode* –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è *mock*'–æ–≤ –¥–ª—è –≤—Å–µ—Ö *interface*'s (!!!) –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Å –∫–æ–¥–æ–º. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–ª–∞–≥ `-source`.

```
mockgen -source=<source file> [other options]
mockgen -source=foo.go [other options]
```

#### Reflect mode

–í *reflect mode* –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è *mock*'–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è *reflection*. –° –µ–µ –ø–æ–º–æ—â—å—é –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è *interface*'s –≤ *package*. 

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è *reflection mode* –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –±–µ–∑ —Ñ–ª–∞–≥–æ–≤:

- *import path*. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.` —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å *import path* –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ *package* (—É–¥–æ–±–Ω–æ –¥–ª—è `go:generate`)
- *interface*'s. –í *reflect mode* –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, –¥–ª—è –∫–∞–∫–∏—Ö *interface*'s –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å *mock*'s. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ *interface*'s, –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é `,` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Service1,Service2`).

```b
mockgen <import path> <interface's>

mockgen database/sql/driver Conn,Driver
mockgen . Conn,Driver
```

#### –§–ª–∞–≥–∏

- `-source` ‚Äì —Ñ–∞–π–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π *interface*'s, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç *mock*'–∞—Ç—å—Å—è
- `-destination` ‚Äì —Ñ–∞–π–ª, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π *source code*. –ï—Å–ª–∏ —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –Ω–µ —É–∫–∞–∑–∞–Ω, —Ç–æ *source code* –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω –Ω–∞ *standard output*.
- `-package` ‚Äì *package name*, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–º–µ—â–µ–Ω *source code* –¥–ª—è *mock*'–∞. –ï—Å–ª–∏ —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –Ω–µ —É–∫–∞–∑–∞–Ω, —Ç–æ –∫ *package name* –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Å–ø–µ—Ä–µ–¥–∏ –±—É–¥–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–æ `mock_` (`mock_<package_name>`).
- `-mock_names`: –°–ø–∏—Å–æ–∫ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏–º–µ–Ω –¥–ª—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö *mock*'–æ–≤. –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—è—Ç—ã–º–∏ `,` —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä  `Repository=MockSensorRepository,Endpoint=MockSensorEndpoint`, –≥–¥–µ `Repository` ‚Äì –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ `MockSensorRepository` ‚Äì –∂–µ–ª–∞–µ–º–æ–µ –∏–º—è mock'–∞. –ï—Å–ª–∏ —É –∫–∞–∫–æ–≥–æ-—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏–º—è, —Ç–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ–± –∏–º–µ–Ω–∞—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.







#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ —Å mock'–∞–º–∏ `mock_XXX.go`

```go
// Code generated by MockGen. DO NOT EDIT.

// –§–∞–π–ª, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—ã–ª —Å–æ–∑–¥–∞–Ω mock: 
// Source: service.go

// Package, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª —É–∫–∞–∑–∞–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ mock'–∞
package service_test

import (
	reflect "reflect"

	gomock "github.com/golang/mock/gomock"
)

// –°–∞–º mock –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Service
type MockService struct {
	ctrl     *gomock.Controller
	recorder *MockServiceMockRecorder
}

// Mock recorder (??? —Ä–µ–∫–æ—Ä–¥–µ—Ä –æ–∂–∏–¥–∞–Ω–∏–π mock'–∞), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å expectation's
type MockServiceMockRecorder struct {
	mock *MockService
}

// –ú–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ mock instance (`MockService`)
func NewMockService(ctrl *gomock.Controller) *MockService {
	mock := &MockService{ctrl: ctrl}
	mock.recorder = &MockServiceMockRecorder{mock}
	return mock
}

// –ú–µ—Ç–æ–¥ EXPECT ‚Äì –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–∏—à–Ω–∏–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ mock'—É —Å–µ—Ä–≤–∏—Å–∞ (`MockService`).
// –¢.–µ —Ç–∞–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞ –Ω–µ—Ç –≤ –∏—Å—Ö–æ–¥–Ω–æ–º interface. 
// –ü–æ—ç—Ç–æ–º—É, –≤–µ—Ä–æ—è—Ç–Ω–æ, —á—Ç–æ–±—ã –∏–º—è –º–µ—Ç–æ–¥–∞ (expect) –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–æ —Å –∏–º–µ–Ω–∞–º–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º interface, 
// –µ–≥–æ –∑–∞–ø–∏—Å–∞–ª–∏ –ø—Ä–æ–ø–∏—Å–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ (EXPECT).
// –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ mock'–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç object —Ç–∏–ø–∞ MockServiceMockRecorder, 
// –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å expectation's
func (m *MockService) EXPECT() *MockServiceMockRecorder {
	return m.recorder
}

// –ù–∏–∂–µ –º–µ—Ç–æ–¥—ã mock'–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç –º–µ—Ç–æ–¥—ã –∏—Å—Ö–æ–¥–Ω–æ–≥–æ interface
// –¢.–µ. —É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ interface –µ—Å—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `DoSomething(int) error`
func (m *MockService) DoSomething(arg0 int) error {
	m.ctrl.T.Helper()
	ret := m.ctrl.Call(m, "DoSomething", arg0)
	ret0, _ := ret[0].(error)
	return ret0
}

// –ù–∏–∂–µ –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Ä–µ–∫–æ—Ä–¥–µ—Ä–µ –æ–∂–∏–¥–∞–Ω–∏–π mock'–∞
// –≠—Ç–∏ –º–µ—Ç–æ–¥—ã - –æ–¥–Ω–æ–∏–º–µ–Ω–Ω—ã–µ —Å –º–µ—Ç–æ–¥–∞–º–∏ mock'–∞ (–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ interface). 
// –¢.–µ. —É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ interface –µ—Å—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `DoSomething()`
// –£ —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —Ç–∏–ø –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ interface{}. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –≤–º–µ—Å—Ç–æ int - interface{} 
// (–Ω–∞–≤–µ—Ä–Ω—è–∫–∞, —Ç.–∫. –º–µ—Ç–æ–¥–∞–º —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å matcher)
// –ú–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–±—ä–µ–∫—Ç gomock.Call, –æ—Ç–Ω–æ—Å—è—â–∏–π—Å—è –∫ –º–µ—Ç–æ–¥—É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ interface 
// –û–±—ä–µ–∫—Ç gomock.Call –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–π –≤—ã–∑–æ–≤ –∫ mock'—É (parameter values, return value) 
func (mr *MockServiceMockRecorder) DoSomething(arg0 interface{}) *gomock.Call {
	mr.mock.ctrl.T.Helper()
	return mr.mock.ctrl.RecordCallWithMethodType(mr.mock, "DoSomething", reflect.TypeOf((*MockService)(nil).DoSomething), arg0)
}

```

–ï—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã:

- `MockService` ‚Äì *mock* –∏—Å—Ö–æ–¥–Ω–æ–≥–æ *interface*
- `MockServiceMockRecorder` ‚Äì —Ä–µ–∫–æ—Ä–¥–µ—Ä –æ–∂–∏–¥–∞–Ω–∏–π *mock*'–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å *expectation*'s –¥–ª—è *mock*'–∞. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞ *recoreder*'–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã, –æ–¥–Ω–æ–∏–º–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–∞–º *mock*'–∞ (–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ *interface*) (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DoSomething()`) 
- `gomock.Controller` ‚Äì *mock controller*, –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ *expectation*'s, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–∏–º *mock*'–æ–≤.
- `gomock.Call` ‚Äì —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º—É –º–µ—Ç–æ–¥—É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ *interface*. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–π –≤—ã–∑–æ–≤ –∫ *mock*'—É (*parameter values, return value*) ([link](#gomockcall))





## –ü—Ä–∏–º–µ—Ä

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

–í–æ–∑—å–º–µ–º –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –¥–≤–∞ —Ñ–∞–π–ª–∞:

- *interface* –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ `Service` –≤ —Ñ–∞–π–ª–µ `service/service.go`:

  ```go
  package service
  
  type Service interface {
  	DoSomething(int) error
  }
  ```

- *struct* –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `Handler`, –∫–æ—Ç–æ—Ä—ã–π –≤ –º–µ—Ç–æ–¥–µ `Handle()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç *interface* `Service`. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `handler/handler.go`:

  ```go
  package handler
  
  import "github.com/parshikovpavel/hello/service"
  
  type Handler struct {
  	Service service.Service
  }
  
  func (h *Handler) Handle() error {
  	return h.Service.DoSomething(123)
  }
  ```



–ò—Ç–∞–∫ *module* –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```
'-- service
    '-- service.go
    '-- mock_service.go
'-- handler
    '-- handler.go
    '-- handler_test.go
```

[–û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –º–æ–¥—É–ª—è —Å –≤–Ω–µ—à–Ω–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é](Design.md#–æ–±—â–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ-–º–æ–¥—É–ª—è-—Å-–≤–Ω–µ—à–Ω–µ–π-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é)



### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è *mock*'–∞

–†–∞–∑–º–µ—Å—Ç–∏–º *mock* –¥–ª—è *interface* `Service`  –≤ —Ç–æ–º –∂–µ —Å–∞–º–æ–º `package service` –≤ —Ñ–∞–π–ª–µ `service/mock_service.go`. 

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ *mock*'–∞ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å.

#### –†—É—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

- –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ *source mode* ([link](#source-mode)):

  ```bash
  mockgen -package service_test -destination mock_service.go -source service.go
  ```

- –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ *reflect mode* ([link](#reflect-mode)):

  ```bash
  mockgen -package service_test -destination mock_service.go github.com/parshikovpavel/hello/service Service
  ```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `go generate`

–í—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `mockgen` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ *interface* (–∏–ª–∏ *file*) —Å–ª–∏—à–∫–æ–º –Ω–µ—É–¥–æ–±–Ω–æ. –ü–æ—ç—Ç–æ–º—É –∑–∞–ø—É—Å–∫ `mockgen` –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞–∑–∏—Ä–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é [`go generate`](–ö–æ–º–∞–Ω–¥–∞ go#go-generate) .

–û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è `//go:generate mockgen`:

- –í —Ñ–∞–π–ª–µ, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–∞–º–æ–∫–∞—Ç—å, —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞. 

- –ö–æ–º–∞–Ω–¥–∞  –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ `.go` —Ñ–∞–π–ª–∞. –ù–æ –µ–µ —á–∞—â–µ –≤—Å–µ–≥–æ —Ä–∞–∑–º–µ—â–∞—é—Ç –Ω–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ –∏–ª–∏ –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ —Å `package`.

- –ö–æ–º–∞–Ω–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç *mock*'–∏ –¥–ª—è –≤—Å–µ—Ö *interface*'s –≤ —Ñ–∞–π–ª–µ ([source mode](#source-mode)). –ü—Ä–æ—â–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å *source mode*.

- *Mock* –¥–ª—è *interface* —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ —Ç–æ–º –∂–µ —Å–∞–º–æ–º *package* –∏ –≤ —Ç–æ–π –∂–µ —Å–∞–º–æ–π directory. *Mock*'–∏ –¥–ª—è —Ñ–∞–π–ª–∞ `xxx.go` –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª `mock_xxx.go`.

- –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å *mock*'–∏ –¥–ª—è –ª—é–±–æ–≥–æ —Ñ–∞–π–ª–∞, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è —Ç–æ–≥–æ, –≥–¥–µ —Ä–∞–∑–º–µ—â–µ–Ω `//go:generate`. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å *mock*'–∏ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã—Ö *interface*'s.

  ```go
  //go:generate mockgen -destination mock_metrics_test.go -package $GOPACKAGE -mock_names Client=MockMetrics go.xxx.ru/gl/metrics Client
  ```

- –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å *mock* –≤ *package* `XXX_test`, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∏–º–µ–Ω–∏ *package* –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `${GOPACKAGE}_test`:

  ```go
  //go:generate mockgen -source $GOFILE -destination mocks_test.go -package ${GOPACKAGE}_test
  ```

  

–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `service/service.go`:

```go
//go:generate mockgen -package ${GOPACKAGE} -destination mock_service.go -source $GOFILE
package service

type Service interface {
	DoSomething(int) error
}
```

*Current working directory* –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥—ã `mockgen` ‚Äì —ç—Ç–æ *directory*, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∞–π–ª —Å `//go generate`.

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ *mock*'–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑ *project‚Äôs root directory* –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É ([link](–ö–æ–º–∞–Ω–¥–∞ go.md#go-generate)):

```
go generate ./...
```

### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞

–†–∞–∑–º–µc—Ç–∏–º —Ç–µ—Å—Ç –¥–ª—è `Handler` –≤ —Ñ–∞–π–ª–µ `handler/handler_test.go`.

```go
package handler_test

import (
	"github.com/golang/mock/gomock"
	"github.com/parshikovpavel/hello/handler"
	"github.com/parshikovpavel/hello/service"

	"testing"
)

func TestUse(t *testing.T) {
	ctrl := gomock.NewController(t) // –ü–æ–ª—É—á–µ–Ω–∏–µ mock controller'–∞
	defer ctrl.Finish()             // –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Go 1.4+

	mockService := service.NewMockService(ctrl) // –°–æ–∑–¥–∞–Ω–∏–µ mock'–∞ –¥–ª—è interface Service

  // –í—ã–∑–æ–≤ mockService.EXPECT() –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ expectation's (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ –ª–∏—Å—Ç–∏–Ω–≥–µ mock'–∞)
	// –û–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ DoSomething –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –æ–¥–∏–Ω —Ä–∞–∑ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º 123, –≤–µ—Ä–Ω–µ—Ç –∏–∑ –º–µ—Ç–æ–¥–∞ nil
	mockService.EXPECT().DoSomething(123).Return(nil).Times(1)

	// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ handler'–∞ –∏ –∏–Ω–¥–∂–µ–∫—Ç–∏–º –≤ –Ω–µ–≥–æ mockService
	testHandler := handler.Handler{
		Service: mockService,
	}

	// –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ handler'–∞
	testHandler.Handle()
}
```

#### –ü–æ—Ä—è–¥–æ–∫ –æ–ø–∏—Å–∞–Ω–∏—è *expectation*

```go
	mockService.EXPECT().DoSomething(123).Return(nil).Times(1)
```

- –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ `EXPECT()`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç *recorder* –æ–∂–∏–¥–∞–Ω–∏–π. 
- –ù–∞ *recoreder*'–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã, –æ–¥–Ω–æ–∏–º–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–∞–º *mock*'–∞ (–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ *interface*) (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DoSomething()`). –ê—Ä–≥—É–º–µ–Ω—Ç—ã —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –æ–ø–∏—Å—ã–≤–∞–µ—Ç  –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞. –í –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
  - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  - *matcher*.
- –≠—Ç–∏ –º–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–±—ä–µ–∫—Ç —Å —Ç–∏–ø–æ–º  `type Call` ([link](#call)). –£–∂–µ –Ω–∞ —ç—Ç–æ–º –æ–±—ä–µ–∫—Ç–µ –º–æ–∂–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

  - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤:
    - `MaxTimes()`
    - `MinTimes()`
    - `Times()`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    - `Return()`

#### Matcher –Ω–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –º–µ—Ç–æ–¥–∞

##### Matcher –Ω–∞ –æ–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç

–í –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –æ–ø–∏—Å–∞–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

  ```go
  mockDoer.EXPECT().DoSomething(123)
  ```

- *matcher* (`type Matcher`, [link](#type-matcher)) ‚Äì –∑–∞–¥–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞.

  ```go
  mockDoer.EXPECT().DoSomething(gomock.Any())
  ```

##### Matcher –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

–û–±—ã—á–Ω—ã–π matcher –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –æ–¥–Ω–æ–º—É –∞—Ä–≥–µ–º–µ–Ω—Ç—É. 

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Å–ª–æ–∂–Ω—ã–π *assertion* —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Call.Do()` ([link](#do)).

–ü—Ä–∏–º–µ—Ä: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç (`int`) –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–µ–Ω –¥–ª–∏–Ω–µ –≤—Ç–æ—Ä–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ (`string`):

```go
mockDoer.EXPECT().
    DoSomething(gomock.Any(), gomock.Any()).
    Return(nil).
    Do(func(x int, y string) {
        if x > len(y) {
            t.Fail()
        }
    })
```

##### –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

–î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Call.Return()` ([link](#return))

##### Matcher –Ω–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–≤—Å–µ —Å—Ä–∞–∑—É)

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã –º–µ—Ç–æ–¥–∞ –∏ –≤–µ—Ä–Ω—É—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –º–µ—Ç–æ–¥–∞ mock'–∞ ‚Äì –Ω–µ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Call.DoAndReturn()` ([link](#doandreturn))

#### –°–ª–æ–∂–Ω—ã–µ –∏–º–∏—Ç–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–≤ mock'–∞

–ü—Ä–∏–º–µ—Ä—ã:

- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –±—ã–ª–∏ –≤—ã–∑–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã *mock*'–∞:

  ```go
  var s string
  
  mockIndex.EXPECT().Bar(gomock.Any()).DoAndReturn(
  
  	func(arg string) interface{} {
  		s = arg
  		return "bar"
  	},
  )
  
  r := mockIndex.Bar("foo")
  fmt.Printf("%s %s", r, s) // foo bar
  ```

- –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ 1–º—Å –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞:

  ```go
  mockIndex := NewMockFoo(ctrl)
  
  mockIndex.EXPECT().Bar().DoAndReturn(
  	func(arg string) string {
  		time.Sleep(1 * time.Millisecond)
  		return "foo"
  	},
  )
  
  r := mockIndex.Bar()
  fmt.Println(r) // foo
  ```

  



#### –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è call order

–°—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–∏—Å–∞–Ω–∏—è call order:

- —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `Call.After()` ([link](#after)):

  ```go
  callFirst := mockDoer.EXPECT().DoSomething(1)
  callA := mockDoer.EXPECT().DoSomething(2).After(callFirst)
  callB := mockDoer.EXPECT().DoSomething(3).After(callFirst)
  ```

  –£—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –ø–æ—Å–ª–µ `callFirst` –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –≤—ã–∑–æ–≤ –∏–ª–∏ `callA` –∏–ª–∏ `callB`.

- —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `gomock.InOrder()` ([link](#func-inorder)), –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–æ–≤. –≠—Ç–æ –º–µ–Ω–µ–µ –≥–∏–±–∫–æ, —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `Call.After`, –Ω–æ –±–æ–ª–µ–µ —á–µ–ª–æ–≤–µ–∫–æ-–ø–æ–Ω—è—Ç–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –≤—ã–∑–æ–≤–æ–≤:

  ```go
  gomock.InOrder(
      mockDoer.EXPECT().DoSomething(1),
      mockDoer.EXPECT().DoSomething(2),
      mockDoer.EXPECT().DoSomething(3),
      mockDoer.EXPECT().DoSomething(4),
  )
  ```









#### –î–µ—Ç–∞–ª–∏:

- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Go 1.14+ –∏ mockgen 1.5.0+ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `ctrl.Finish()`, —ç—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. 

- –°–∞–º –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ *expectation*'s –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `Controller.Finish()`. 

- *Mock controller* –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö *mock*'–æ–≤:

  ```go
  	ctrl := gomock.NewController(t) // –ü–æ–ª—É—á–µ–Ω–∏–µ mock controller'–∞
  
  	mockService := service.NewMockService(ctrl) // –°–æ–∑–¥–∞–Ω–∏–µ mock'–∞ –¥–ª—è interface Service
  	mockService1 := service.NewMockService1(ctrl) // –°–æ–∑–¥–∞–Ω–∏–µ mock'–∞ –¥–ª—è interface Service1
  ```



#### –ü—Ä–∏–µ–º—ã

**–û–ø–∏—Å–∞–Ω–∏—è *expectation*, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –º–µ—Ç–æ–¥–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä `err`), —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É.** 

–ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å GD –¥–ª—è —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ *mock* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `err`. 

```go
	err := errors.New("alarm")

	// –û–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ DoSomething –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –æ–¥–∏–Ω —Ä–∞–∑ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º 123, –≤–µ—Ä–Ω–µ—Ç –∏–∑ –º–µ—Ç–æ–¥–∞ nil
	mockService.EXPECT().DoSomething(123).Return(err)

	// –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ handler'–∞ –∏ –∏–Ω–¥–∂–µ–∫—Ü–∏—è –≤ –Ω–µ–≥–æ mockService
	testHandler := handler.Handler{
		Service: mockService,
	}

	// –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ handler'–∞
	result := testHandler.Handle()

	if result != err {
		t.Fail()
	}
```

–õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç `github.com/stretchr/testify/require`

**–£–∫–∞–∑–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ mock –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤–µ—Ä–Ω–µ—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –∑–∞—Ç–µ–º –¥—Ä—É–≥–æ–µ**

–ù–∞–ø—Ä–∏–º–µ—Ä, 2 —Ä–∞–∑–∞ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –∏ 1 —Ä–∞–∑ ‚Äì —É—Å–ø–µ—Ö.

```go
client.EXPECT().GetDocumentsByTypesV1(ctx, in).Return(nil, errors.New("error")).Times(2)
client.EXPECT().GetDocumentsByTypesV1(ctx, in).Return(out, nil).Times(1)
```





## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### `func InOrder()`

```go
func InOrder(calls ...*Call)
```

–£—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ `calls` –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ.



### `type Call`

```go
type Call struct {
	// contains filtered or unexported fields
}
```

`Call` –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–π –≤—ã–∑–æ–≤ –∫ *mock*'—É.  

–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–∏–ø–∞ `Call` —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ –≥—Ä—É–ø–ø—ã:

- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–æ–º –≤—ã–∑–æ–≤–æ–≤:
  - `After()`

- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤:
  - `MaxTimes()`
  - `MinTimes()`
  - `Times()`
- –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  - `Return()`





#### `After()`

```go
func (c *Call) After(preReq *Call) *Call
```

`After()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –≤—ã–∑–æ–≤ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `preReq`.

#### `AnyTimes()`

```go
func (c *Call) AnyTimes() *Call
```

`AnyTimes()` –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ 0 –∏–ª–∏ –±–æ–ª–µ–µ –≤—ã–∑–æ–≤–æ–≤.

#### `Do()`

```go
func (c *Call) Do(f interface{}) *Call
```

–§—É–Ω–∫—Ü–∏—è `f`  –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ *mock*'–∞. –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è. –ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DoAndReturn()`.

[link](#matcher-–Ω–∞-–Ω–µ—Å–∫–æ–ª—å–∫–æ-–∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤)

#### `DoAndReturn()`

```go
func (c *Call) DoAndReturn(f interface{}) *Call
```

–§—É–Ω–∫—Ü–∏—è `f`  –≤—ã–∑—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ *mock*'–∞. –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `f()` ‚Äì –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥–æ–º mock'–∞. 

–°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `f()` –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π –º–µ—Ç–æ–¥–∞, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è *mock*.

[link](#matcher-–Ω–∞-–∞—Ä–≥—É–º–µ–Ω—Ç—ã-–∏-–≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ-–∑–Ω–∞—á–µ–Ω–∏–µ-–≤—Å–µ-—Å—Ä–∞–∑—É)

#### `MaxTimes()`

```go
func (c *Call) MaxTimes(n int) *Call
```

`MaxTimes()` —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–µ –±–æ–ª–µ–µ `n` –≤—ã–∑–æ–≤–æ–≤. 

#### `MinTimes()`

```go
func (c *Call) MinTimes(n int) *Call
```

`MinTimes` —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –∫–∞–∫ –º–∏–Ω–∏–º—É–º `n` –≤—ã–∑–æ–≤–æ–≤.

#### `Return()`

```go
func (c *Call) Return(rets ...interface{}) *Call
```

`Return()` —É–∫–∞–∑—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ *mock*'–∞.

#### `Times()`

```go
func (c *Call) Times(n int) *Call
```

`Times()` —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∂–∏–¥–∞–µ–º—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –≤—ã–∑–æ–≤–∞.

`Times()` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –∫–∞–∫ *expectation*, –Ω–æ –æ–Ω —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–µ–ª–∞—Ç—å `Return()` –∫–∞–∫–æ–≥–æ-—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è ([link](#–ø—Ä–∏–µ–º—ã))

### `type Matcher`

```go
type Matcher interface {
	// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ x –∏–ª–∏ –Ω–µ—Ç
	Matches(x interface{}) bool

	// –û–ø–∏—Å—ã–≤–∞–µ—Ç, —á–µ–º—É –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å x –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —ç—Ç–∏–º matcher'–æ–º
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–≥–æ –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
	String() string
}
```

#### `Any()`

```go
func Any() Matcher
```

`Any()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Matcher`, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ –Ω–∞–º –Ω–µ –≤–∞–∂–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞:

```
mockDoer.EXPECT().DoSomething(gomock.Any(), "Hello GoMock")
```

#### `Eq()`

```
func Eq(x interface{}) Matcher
```

`Eq()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Matcher`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π (DeepEqual???).

–ê—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç —Ç–∏–ø –ù–ï `Matcher`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –º–∞—Ç—á–µ—Ä—É `Eq`. 

–î–≤–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∏–∂–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã:

```go
mockDoer.EXPECT().DoSomething("Hello GoMock")
mockDoer.EXPECT().DoSomething(gomock.Eq("Hello GoMock"))
```

#### `Nil()`

```go
func Nil() Matcher
```

`Nil()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Matcher`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º *nil*.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ matcher'–∞

–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π *matcher* ‚Äì —ç—Ç–æ `type`, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç `gomock.Matcher` *interface* ([link](#type-matcher)).

–ü—Ä–∏–º–µ—Ä *matcher*'–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–∏–ø –∞—Ä–≥—É–º–µ–Ω—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–æ–∫–µ:

```go
package ofType

import (
    "reflect"
    "github.com/golang/mock/gomock"
)

type matcher struct{ t string }

func New(t string) gomock.Matcher {
    return &matcher{t}
}

func (o *matcher) Matches(x interface{}) bool {
    return reflect.TypeOf(x).String() == o.t
}

func (o *matcher) String() string {
    return "is of type " + o.t
```

–ü—Ä–∏–º–µ—Ä –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```go
mockDoer.EXPECT().
    DoSomething(match.OfType("int")).
    Return(nil).
    Times(1)
```







# Testify

https://github.com/stretchr/testify

–£—Å—Ç–∞–Ω–æ–≤–∫–∞:

```bash
go get github.com/stretchr/testify
```



## –ü—Ä–∏–º–µ—Ä

*Assertion* –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ *standard library* –≤ Go. –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å *assertion* –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ —É—Å–ª–æ–≤–∏–µ `if`. –ù–æ —ç—Ç–æ –≤—ã–ª—è–¥–∏—Ç –Ω–µ "—á–∏—Å—Ç–æ" –∏ —Å–ª–æ–∂–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è.

–î–æ–ø—É—Å—Ç–∏–º –Ω–∞–¥–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é:

```go
func Calculate(x int) int {
  return x + 2
}
```

–¢–µ—Å—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ *testify* –≤—ã–≥–ª—è–¥–µ–ª –±—ã —Ç–∞–∫:

```go
func TestCalculate(t *testing.T) {
    if Calculate(2) != 4 {
        t.Error("Expected 2 + 2 to equal 4")
    }
}
```

–¢–µ—Å—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ *testify*:

```go
func TestCalculate(t *testing.T) {
  assert.Equal(t, Calculate(2), 4)
}
```







## `assert` package

https://pkg.go.dev/github.com/stretchr/testify/assert

`assert` *package* –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç:

- –≤—ã–≤–æ–¥–∏—Ç –æ–ø–∏—Å–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- –∫–∞–∂–¥—ã–π *assertion* –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–ø–æ–ª–Ω–µ–Ω –∞–Ω–æ—Ç–∞—Ü–∏–µ–π (?)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –≤ `assert` *package*:

- –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è `assert.XXX()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `bool`, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –±—ã–ª–æ –ª–∏ *assertion* —É—Å–ø–µ—à–Ω—ã–º –∏–ª–∏ –Ω–µ—Ç.

  –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö *assertion*'s –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä:

  ```go
  func TestSomething(t *testing.T) {
    if assert.NotNil(t, object) {
      // —Ç–µ–ø–µ—Ä—å –æ–±—ä–µ–∫—Ç —Ç–æ—á–Ω–æ NotNil, –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å–Ω–µ–π—à–∏–µ assertions –±–µ–∑ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–æ–∫
      assert.Equal(t, "Something", object.Value)
    }
  }
  ```

- –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è `assert.XXX()` –∏–º–µ–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç `msgAndArgs` ‚Äì —Å—Ç—Ä–æ–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –æ—à–∏–±–∫–µ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞.

–ï—Å—Ç—å –¥–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–π `assert.XXX()`:

- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å *global function*'s –∏–∑ `assert` *package*.

  –¢–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `assert.XXX()` –ø—Ä–∏–Ω–∏–º–∞—é—Ç `t testing.T` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–≤–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞. 

  ```go
  import (
    "testing"
    "github.com/stretchr/testify/assert"
  )
  
  func TestSomething(t *testing.T) {
  
  	/* ... */
    assert.Equal(t, a, b, "The two words should be the same.")
  }
  ```

  

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Ç–∏–ø–∞ `Assertions.XXX()`

  –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –º–Ω–æ–≥–æ *assertion*, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç `Assertions` —á–µ—Ä–µ–∑ `assert.New()` –∏ –≤—ã–∑—ã–≤–∞—Ç—å –µ–≥–æ –º–µ—Ç–æ–¥—ã:

  ```go
  func TestSomething(t *testing.T) {
    assert := assert.New(t)
  
    // assert equality
    assert.Equal(123, 123, "they should be equal")
  
    // assert inequality
    assert.NotEqual(123, 456, "they should not be equal")
  }
  ```



TODO!!!

https://pkg.go.dev/github.com/stretchr/testify/assert#InEpsilon

https://github.com/stretchr/testify#installation

https://jfrog.com/blog/top-go-modules-writing-unit-tests-with-testify/



## `require` package

–í `require` *package* –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ç–µ –∂–µ —Å–∞–º—ã–µ *function*'s —á—Ç–æ –∏ –≤  `assert` *package*. –û–¥–Ω–∞–∫–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –≤–º–µ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ *bool* ‚Äì —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–∞—é—Ç —Ç–µ–∫—É—â–∏–π *test*. –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `t.FailNow()` ([link](#failnow)).

## `suite` *package*

https://github.com/stretchr/testify

https://pkg.go.dev/github.com/stretchr/testify/suite

*Package* `suite` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å *testing suite* –≤ –≤–∏–¥–µ *struct*, —É–∫–∞–∑—ã–≤–∞—Ç—å *setup/teardown method*'—ã –∏ *testing method*'—ã –≤ —Å–æ—Å—Ç–∞–≤–µ *struct* –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏—Ö —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `go test`, –∫–∞–∫ –æ–±—ã—á–Ω–æ.

–ü—Ä–∏–º–µ—Ä *suite*:

```go
import (
    "testing"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/suite"
)

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º suite, embed (–≤–∫–ª—é—á–∞–µ–º) –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å 
// suite.Suite - –≤–∫–ª—é—á–∞—è suite.T(), –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 
// —Ç–µ–∫—É—â–∏–π testing context (—Ç.–µ. t *testing.T) 
type ExampleTestSuite struct {
    suite.Suite
    VariableThatShouldStartAtFive int
}

// –£—Å—Ç–∞–Ω–æ–≤–∏–º VariableThatShouldStartAtFive –≤ 5 –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º
func (suite *ExampleTestSuite) SetupTest() {
    suite.VariableThatShouldStartAtFive = 5
}

// –í—Å–µ method'—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `Test`, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–∞–∫ —Ç–µ—Å—Ç—ã –≤–Ω—É—Ç—Ä–∏ suite
func (suite *ExampleTestSuite) TestExample() {
    assert.Equal(suite.T(), 5, suite.VariableThatShouldStartAtFive)
}

// –ß—Ç–æ–±—ã `go test` –∑–∞–ø—É—Å—Ç–∏–ª —ç—Ç–æ—Ç suite, –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å
// –æ–±—ã—á–Ω—É—é test function –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞—à suite –≤ suite.Run
func TestExampleTestSuite(t *testing.T) {
    suite.Run(t, new(ExampleTestSuite))
}
```



### `type Suite`

```go
type Suite struct {
	*assert.Assertions
	// contains filtered or unexported fields
}
```

`Suite` ‚Äî —ç—Ç–æ –±–∞–∑–æ–≤—ã–π *testing suite* —Å –º–µ—Ç–æ–¥–∞–º–∏ *set* –∏ *get* –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ `*testing.T`.





## `assert` –∏–ª–∏ `require`

<u>–õ—É—á—à–µ `require`</u>

–õ—É—á—à–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç `require` (–≤–º–µ—Å—Ç–æ –ø–∞–∫–µ—Ç–∞ `assert`). –û—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–æ–¥—Ä—è–¥ –∏ —Ç–æ–≥–¥–∞ –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ —á–∞—Å—Ç–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤–æ–æ–±—â–µ –∫ –ø–∞–¥–µ–Ω–∏—é —Ç–µ—Å—Ç–æ–≤ –ø–æ *panic*. 

–ù–∞–ø—Ä–∏–º–µ—Ä, –∑–¥–µ—Å—å:

```go
resp, err := client.Do(req)
assert.NoError(t, err)
assert.Equal(t, len(expectedBody), resp.ContentLength)
```

–ï—Å–ª–∏ `client.Do()` –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É (`resp == nil`), —Ç–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ `resp.ContentLength` –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç *panic*.

<u>–ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω `assert`</u>

–ù–æ –µ—Å–ª–∏ —Ö–æ—Ä–æ—à–æ –ø–æ–¥—É–º–∞—Ç—å, —Ç–æ –º–æ–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å –ø–∞–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–∏ —ç—Ç–æ–º –ø—Ä–æ–≥–Ω–∞—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏. –û—Å–æ–±–µ–Ω–Ω–æ —ç—Ç–æ –≤–∞–∂–Ω–æ, –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤ –∏ –ø–∞–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞, –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ, –ø—Ä–µ—Ä–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, —Å–ª–µ–¥—É–µ—Ç –ø–æ—Å—Ç—É–ø–∏—Ç—å —Ç–∞–∫:

```go
resp, err := client.Do(req)
if assert.NoError(t, err) {
	assert.Equal(t, len(expectedBody), resp.ContentLength)
}
// –¥—Ä—É–≥–∏–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
```

<u>–ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ –≤ —Ü–∏–∫–ª–µ</u>

–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ –≤ —Ü–∏–∫–ª–µ (—á–∞—Å—Ç–æ –¥–ª—è *table-driven test*), –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å *subtest* –∏ `t.Run()`. –í–Ω—É—Ç—Ä–∏ *subtest* –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `require`, –Ω–µ –±–æ—è—Å—å –∑–∞–≤–∞–ª–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã:

```go
for _, c := range cases {
    t.Run("check "+c.str, func(t *testing.T) {
        resp, err := fn(c.str)
        require.Nil(t, err)
        require.Equal(t, c.expected, resp.ContentLength)
    })
}
```







## –§—É–Ω–∫—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã

–î–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ –µ—Å—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `f`, —á—Ç–æ–±—ã –æ–ø–∏—Å–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å—Ç—Ä–æ–∫–∏ —Å `msg`.

### `Equal()`

```go
func Equal(t TestingT, expected, actual interface{}, msgAndArgs ...interface{}) bool
```

`Equal()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–≤–Ω—ã.

–î–ª—è *pointer*'s –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ —Å—Å—ã–ª–∞—é—Ç—Å—è (–∞ –Ω–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ –≤ –ø–∞–º—è—Ç–∏).

<u>–ü—Ä–∏–º–µ—Ä:</u>

```
assert.Equal(t, 123, 123)
```

### `Error()`

```go
func Error(t TestingT, err error, msgAndArgs ...interface{})
```

`Error()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äì *error* (—Ç.–µ. –Ω–µ `nil`)



### `ErrorIs()`

```go
func ErrorIs(t TestingT, err error, target error, msgAndArgs ...interface{})
```

`ErrorIs()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –æ–¥–Ω–∞ –∏–∑ –æ—à–∏–±–æ–∫ –≤ —Ü–µ–ø–æ—á–∫–µ `err` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `target`. –≠—Ç–æ –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è `errors.Is()`.



### `ElementsMatch()`

```go
func ElementsMatch(t TestingT, listA, listB interface{}, msgAndArgs ...interface{}) (ok bool)
```

`ElementsMatch()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π `listA` (array, slice...) —Ä–∞–≤–µ–Ω —É–∫–∞–∑–∞–Ω–Ω–æ–º—É `listB` (array, slice...), –∏–≥–Ω–æ—Ä–∏—Ä—É—è –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∏—Ö –≤ –æ–±–æ–∏—Ö —Å–ø–∏—Å–∫–∞—Ö –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å.

–° —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ *slice* –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞.

```go
assert.ElementsMatch(t, [1, 3, 2, 3], [1, 3, 3, 2])
```





### `False()`

```go
func False(t TestingT, value bool, msgAndArgs ...interface{}) bool
```

`False()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ `value == false`.

–ü—Ä–∏–º–µ—Ä:

```go
assert.False(t, myBool)
```









### `Implements()`

```go
func Implements(t TestingT, interfaceObject interface{}, object interface{}, msgAndArgs ...interface{}) bool
```

`Implements()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ `object` —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π *interface* (`interfaceObject`).

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≤–∏–¥–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:

```go
assert.Implements(t, (*MyInterface)(nil), obj)
assert.Implements(t, (*MyInterface)(nil), new(T))
```

–≥–¥–µ:

- `(*MyInterface)(nil)` ‚Äì *conversion* ([link](Lang.go#conversion)) `nil` –≤ `*MyInterface` 

  





TODO!!!

https://jfrog.com/blog/top-go-modules-writing-unit-tests-with-testify/





### `Nil()`

```go
func Nil(t TestingT, object interface{}, msgAndArgs ...interface{}) bool
```

`Nil()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `== nil`.

<u>–ü—Ä–∏–º–µ—Ä:</u>

```go
assert.Nil(t, err)
```



### `NoError()`

```go
func NoError(t TestingT, err error, msgAndArgs ...interface{}) bool
```

`NoError()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ `error` (—Ç.–µ. –≤–µ—Ä–Ω—É–ª–∞ `nil`).

```go
  actualObj, err := SomeFunction()
  if assert.NoError(t, err) {
	   assert.Equal(t, expectedObj, actualObj)
  }
```

–†–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `assert.Nil()`, –Ω–æ –≤—ã–≤–æ–¥–∏—Ç –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –æ—à–∏–±–∫—É.



### `NotEqual()`

```go
func NotEqual(t TestingT, expected, actual interface{}, msgAndArgs ...interface{}) bool
```

`NotEqual()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–≤–Ω—ã.

–î–ª—è pointer's –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ —Å—Å—ã–ª–∞—é—Ç—Å—è (–∞ –Ω–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ –≤ –ø–∞–º—è—Ç–∏).

–ü—Ä–∏–º–µ—Ä:

```
assert.NotEqual(t, 123, 345)
```

### `NotNil()`

```go
func NotNil(t TestingT, object interface{}, msgAndArgs ...interface{}) bool
```

`NotNil()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `!= nil`.

<u>–ü—Ä–∏–º–µ—Ä:</u>

```go
assert.NotNil(t, err)
```

### `True()`

```go
func True(t TestingT, value bool, msgAndArgs ...interface{}) bool
```

`True()` —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ `value == true`.

–ü—Ä–∏–º–µ—Ä:

```go
assert.True(t, myBool)
```





## –¢–∏–ø—ã

### `type TestingT`

```go
type TestingT interface {
	Errorf(format string, args ...interface{})
}
```

`TestingT` - —ç—Ç–æ *interface* –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `*testing.T`

