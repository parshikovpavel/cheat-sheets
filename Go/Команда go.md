# Packages

Многие *comman*d'ы `go`  применяются к `packages` – списку *import path*'s

```go
go <action> [packages]
```

Правила интерпретации *import path*:

- *Import path*, который является корневым путем (наверное, вроде `/Users/...`) или начинаются с `./` или `../` (*relative import path*, [link](#relative-import-path)) – интерпретируется как путь в файловой системе и обозначает *package* в этом каталоге.

- иначе *import path* `path` обозначает *package*, найденный в каталоге `DIR/src/path`, где `DIR`–  одна из папок, перечисленных в `GOPATH`.
- если *import path* не указан, `go <action>` применяется к *package* в текущем каталоге.

*Import path* называется *pattern*, если он включает один или несколько подстановочных знаков `...`, каждый из которых может соответствовать любой строке, включая пустую строку и строки, содержащие `/`. Такой *pattern* распространяется на все *package directories* внутри `GOPATH`, соответствующие *pattern*'у (??? точно внутри `GOPATH`, вроде и на *relative import path*)

Две особенности применения *wildcard* `...`:

- в конце строки `/...` – также соответствует пустой строке. Например, `net/...` соответствовает `net` и *package*'s во всех подкаталогах `net`. 
- *wildcard* `...`  не сопоставляется с каталогом `vendor`. Так что `./...` не соответствует *package*'s в подкаталогах `./vendor` или `./mycode/vendor`. 

## Relative import path

*Import path*, который начинается с `./` и `../` , – называется *relative import path*. 

*Relative import path* поддерживаются в двух случаях:

- В *сommand* `go` вместо `packages` . 

  Примеры применения:

  - Находишься по *import path* `unicode`, хочешь протестировать по *import path* `unicode/utf8`:

    ```bash
    go test ./utf8
    ```

  - Находишься по *import path* `unicode/utf8`, хочешь протестировать по *import path* `unicode`:

    ```bash
    go test ..
    ```

  - Протестировать все нижележащие *import path*'s (поддиректории):

    ```go
    go test ./...
    ```

- ...













# `go generate`

Команда `go generate` позволяет автоматизировать генерацию исходного кода перед компиляцией, используя инструменты самого Go. `go generate` позволяет избежать использования *Makefile* и *Bash script*. 

```bash
go generate [-n] [-v] [-x] [file.go... | packages]
```

Флаги:

- `-v` выводит имена пакетов и файлов по мере их обработки. 
- `-n` выводит команды, которые будут выполнены. 
- `-x` выводит команды по мере их выполнения.

`go generate` никогда не запускается автоматически при запуске команд `go build`, `go get`, `go test` и т.д. `go generate` нужно запускать явно. 

`go generate` сканирует файл на наличие директив вида:

```go
//go:generate command argument...
```

Эти директивы могут находиться в любом месте `.go` файла. Команду `//go:generate mockgen ...`  чаще всего размещают на первой строке или после строки с `package`.

`go generate` запускает эти команды, описанные директивой `//go:generate` внутри файлов. Без аргументов `go generate` сканирует файлы, относящиеся к текущему *package*.

Внутри `//go:generate` можно использовать любые команды, но изначально предполагается, что там размещаются команды для создания или обновления исходных файлов на Go.

Например `go generate`, для которой в качестве команды задано `echo`:

```go
package project

//go:generate echo Hello, Go Generate!

func Add(x, y int) int {
	return x + y
}
```

```bash
$ go generate
Hello, Go Generate!
```

Не должно быть пробелов:

- перед комментарием `//go:generate...`
- внутри `//go`

Параметры:

- `command` –  исполняемый файл, который может запускаться локально.
- `argument` – аргументы команды, разделенные пробелами. В качестве аргументов можно использовать строки в двойных кавычках, каждая строка – отдельных аргумент. Строки в кавычках вычисляются и используют синтаксис Go.

Чтобы сообщить людям и другим программам, что код выходного файла сгенерирован, сгенерированный файл должен включать строку, которая соответствует следующему регулярному выражению:

```go
^// Code generated .* DO NOT EDIT\.$
```

Эта строка должна располагаться перед любым не-комментарием или не-пробельным текстом в файле.

`go generate` устанавливает несколько *variable*'s, когда запускает команду:

- `$GOFILE` – имя файла
- `$GOPACKAGE` – имя *package* для файла, содержащего директиву.

Также в строку подставляются значения *environment variable*'s, определенных в ОС, – `$HOME`, `$NAME`, ...

